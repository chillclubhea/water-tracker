<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase æ¸¬è©¦ - ä¿®æ­£ç‰ˆ</title>
   <!-- ç¢ºä¿åœ¨ä»£ç¢¼ä¹‹å‰åŠ è¼‰ Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // æ‚¨çš„ä»£ç¢¼åœ¨é€™è£¡
   const supabase = supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key, {
    auth: {
        autoRefreshToken: true,
        persistSession: true,
        detectSessionInUrl: true
</script>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 50px auto; padding: 20px; }
        .test-area { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        button { padding: 10px; margin: 5px; background: #3498db; color: white; border: none; cursor: pointer; }
        .result { padding: 10px; margin: 10px 0; display: none; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ”— Supabase é€£æ¥æ¸¬è©¦ - ä¿®æ­£ç‰ˆ</h1>
    
    <div class="test-area">
        <h3>ç’°å¢ƒè³‡è¨Š</h3>
        <div id="env-info"></div>
    </div>
    
    <div class="test-area">
        <h3>Supabase é€£æ¥æ¸¬è©¦</h3>
        <button onclick="testConnection()">æ¸¬è©¦é€£æ¥</button>
        <div id="connection-result" class="result"></div>
    </div>
    
    <div class="test-area">
        <h3>èªè­‰æ¸¬è©¦</h3>
        <input type="email" id="test-email" placeholder="test@example.com" value="test@example.com">
        <input type="password" id="test-pwd" placeholder="password" value="test123456">
        <button onclick="testAuth()">æ¸¬è©¦èªè­‰</button>
        <div id="auth-result" class="result"></div>
    </div>

    <script>
        // ==================== ç¬¬ä¸€æ­¥ï¼šé…ç½®å’Œåˆå§‹åŒ– ====================
        
        // 1. é…ç½® Supabase
        const SUPABASE_CONFIG = {
            url: 'https://fayorxvfxtrycjiiiyfu.supabase.co',  // æ›¿æ›ç‚ºæ‚¨çš„ URL
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZheW9yeHZmeHRyeWNqaWlpeWZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNzY1MTAsImV4cCI6MjA3OTg1MjUxMH0.7znE_AaNg6zESUO-RoSsyFqxCgcxjPT_pQiN557e6Nw'                      // æ›¿æ›ç‚ºæ‚¨çš„ anon key
        };

        // 2. ç«‹å³åˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯
        const supabase = supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key, {
            auth: {
                autoRefreshToken: true,
                persistSession: true,
                detectSessionInUrl: true
            }
        });

        // 3. é…ç½®é©—è­‰
        function validateConfig() {
            if (!SUPABASE_CONFIG.url || !SUPABASE_CONFIG.key) {
                console.error('âŒ Supabase é…ç½®ç¼ºå¤±');
                return false;
            }
            if (!SUPABASE_CONFIG.url.includes('.supabase.co')) {
                console.error('âŒ Supabase URL æ ¼å¼éŒ¯èª¤');
                return false;
            }
            console.log('âœ… é…ç½®é©—è­‰é€šé');
            return true;
        }

        // ==================== ç¬¬äºŒæ­¥ï¼šåŠŸèƒ½å‡½æ•¸ ====================

        // é¡¯ç¤ºç’°å¢ƒè³‡è¨Š
        function showEnvironmentInfo() {
            document.getElementById('env-info').innerHTML = `
                <p>ç•¶å‰åŸŸå: <strong>${window.location.hostname}</strong></p>
                <p>å”è­°: <strong>${window.location.protocol}</strong></p>
                <p>Supabase é…ç½®: <strong>${validateConfig() ? 'âœ… æœ‰æ•ˆ' : 'âŒ ç„¡æ•ˆ'}</strong></p>
            `;
        }

        // æ¸¬è©¦é€£æ¥
        async function testConnection() {
            const resultEl = document.getElementById('connection-result');
            resultEl.textContent = 'ğŸ”„ æ¸¬è©¦é€£æ¥ä¸­...';
            resultEl.className = 'result';
            resultEl.style.display = 'block';
            
            try {
                // æ¸¬è©¦æŸ¥è©¢ï¼ˆä½¿ç”¨ä¸å­˜åœ¨çš„è¡¨ä¾†è§¸ç™¼ç‰¹å®šéŒ¯èª¤ï¼‰
                const { data, error } = await supabase
                    .from('_test_connection_table_')
                    .select('*')
                    .limit(1);
                
                if (error) {
                    if (error.code === '42P01') {
                        // è¡¨ä¸å­˜åœ¨éŒ¯èª¤ - é€™è¡¨ç¤ºé€£æ¥å¯¦éš›ä¸Šæ˜¯æˆåŠŸçš„ï¼
                        resultEl.textContent = 'âœ… é€£æ¥æˆåŠŸï¼Supabase æœå‹™æ­£å¸¸éŸ¿æ‡‰';
                        resultEl.className = 'result success';
                    } else {
                        resultEl.textContent = `âŒ é€£æ¥éŒ¯èª¤: ${error.message} (ä»£ç¢¼: ${error.code})`;
                        resultEl.className = 'result error';
                    }
                } else {
                    resultEl.textContent = 'âœ… é€£æ¥æˆåŠŸï¼';
                    resultEl.className = 'result success';
                }
            } catch (err) {
                resultEl.textContent = `âŒ ç•°å¸¸: ${err.message}`;
                resultEl.className = 'result error';
            }
        }

        // æ¸¬è©¦èªè­‰
        async function testAuth() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-pwd').value;
            const resultEl = document.getElementById('auth-result');
            
            if (!email || !password) {
                resultEl.textContent = 'âŒ è«‹è¼¸å…¥éƒµç®±å’Œå¯†ç¢¼';
                resultEl.className = 'result error';
                resultEl.style.display = 'block';
                return;
            }
            
            resultEl.textContent = 'ğŸ”„ èªè­‰æ¸¬è©¦ä¸­...';
            resultEl.className = 'result';
            resultEl.style.display = 'block';
            
            try {
                // å…ˆå˜—è©¦è¨»å†Š
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });

                if (error) {
                    if (error.message.includes('already registered') || error.message.includes('ç”¨æˆ¶å·²å­˜åœ¨')) {
                        // ç”¨æˆ¶å·²å­˜åœ¨ï¼Œå˜—è©¦ç™»å…¥
                        const { data: signInData, error: signInError } = await supabase.auth.signInWithPassword({
                            email: email,
                            password: password
                        });
                        
                        if (signInError) {
                            resultEl.textContent = `âŒ ç™»å…¥å¤±æ•—: ${signInError.message}`;
                            resultEl.className = 'result error';
                        } else {
                            resultEl.textContent = 'âœ… ç™»å…¥æˆåŠŸï¼èªè­‰åŠŸèƒ½æ­£å¸¸';
                            resultEl.className = 'result success';
                        }
                    } else {
                        resultEl.textContent = `âŒ è¨»å†Šå¤±æ•—: ${error.message}`;
                        resultEl.className = 'result error';
                    }
                } else {
                    if (data.user && data.session) {
                        resultEl.textContent = 'âœ… è¨»å†Šä¸¦è‡ªå‹•ç™»å…¥æˆåŠŸï¼';
                        resultEl.className = 'result success';
                    } else {
                        resultEl.textContent = 'âœ… è¨»å†Šè«‹æ±‚å·²ç™¼é€ï¼Œè«‹æª¢æŸ¥éƒµç®±ç¢ºèª';
                        resultEl.className = 'result success';
                    }
                }
            } catch (err) {
                resultEl.textContent = `âŒ ç•°å¸¸: ${err.message}`;
                resultEl.className = 'result error';
            }
        }

        // ==================== ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–é é¢ ====================

        // é é¢åŠ è¼‰å®Œæˆå¾ŒåŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é é¢åŠ è¼‰å®Œæˆï¼Œåˆå§‹åŒ– Supabase...');
            showEnvironmentInfo();
            
            // é©—è­‰é…ç½®
            if (!validateConfig()) {
                document.getElementById('connection-result').textContent = 
                    'âŒ Supabase é…ç½®ç„¡æ•ˆï¼Œè«‹æª¢æŸ¥ URL å’Œ Key';
                document.getElementById('connection-result').className = 'result error';
                document.getElementById('connection-result').style.display = 'block';
            } else {
                console.log('âœ… Supabase åˆå§‹åŒ–å®Œæˆ');
            }
        });

    </script>
</body>
</html>
